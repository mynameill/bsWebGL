<!DOCTYPE html>
<html lang="ko">
<head>
	<title>svg파서 개발을 위한 초기 테스트</title>
	<meta name="keywords" content="redcamel, webgl, bsjs, bsWebGL" />
	<meta name="description" content="redcamel, webgl, bsjs, bsWebGL" />
	<meta charset="utf-8" />
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<meta name="format-detection" content="telephone=no" />
	<meta name="apple-mobile-web-app-capable" content="yes" />
	<meta name="apple-mobile-web-app-status-bar-style" content="black" />
	<meta name="viewport"
	      content="width=device-width,user-scalable=no,initial-scale=1,maximum-scale=1,minimum-scale=0.5,target-densitydpi=medium-dpi" />
	<link rel="shortcut icon" href="http://redcamel.github.io/red/red/favicon/favicon.ico" type="image/x-icon">
	<style>body {
		margin: 0;
		padding: 0;
		font-size: 11px
	}</style>
	<script src="http://projectbs.github.io/bsJS/bsjs.0.5.js"></script>

</head>
<body>
<svg style="position:absolute;z-index:1" height="500" width="500">
	<rect width="300" height="100" fill="#223344"></rect>
	<rect width="150" height="150" fill="#223654"></rect>
	<circle cx="50" cy="50" r="40" stroke="black" stroke-width="3" fill="#aa2244" />
	<ellipse cx="240" cy="100" rx="220" ry="30" fill="#aa2244" />
	<ellipse cx="220" cy="70" rx="190" ry="20" fill="#bb2244" />
	<ellipse cx="210" cy="45" rx="170" ry="15" fill="#cc2244" />
	<image xlink:href="../showcase/assets/t1.jpg" x="0" y="0" height="50px" width="50px" />
	<polygon points="200,10 250,190 160,210" fill="#cce244" />
	<polyline points="20,20 40,25 60,40 80,120 120,140 200,180" stroke="#ffee44" style="fill:none;" />
	<line x1="0" y1="0" x2="200" y2="200" stroke="#cc2244" stroke-width="3" />
</svg>
<script>
	bs.debug(0)
	bs(function () {
		bs.require(function () {
			bs.GL.init('#glCanvas', '../shaders.js', init)
			function init() {


//				bs.GL.Mesh('circle').S('<',bs.GL,'scaleX',100,'scaleY',100,'material','assets/t2.jpg,BL')
//				bs.GL.Mesh('circle').S('<',bs.GL,'scaleX',100,'scaleY',100,'material','#fff','renderMode','LINES')

				//파서테스트
				//svg파서 개발을 위한 초기 테스트
				bs.GL['parserSVG'] = (function () {
					function checkColor(fill) {
						var t = fill ? fill : '#fff'
						// rgb일떄 그냥 명시적 색상일떄도 고려해야함
						return t
					}
					function checkLineColor(stroke) {
						var t = stroke ? stroke : '#fff'
						// rgb일떄 그냥 명시적 색상일떄도 고려해야함
						return t
					}

					return function (svg) {

						var i, j = 0, t0 = svg.childNodes, len = t0.length, t1 = [], t3, t2, t4, t5
						for (i = 0; i < len; i++) t0[i].nodeType != 3 ? t1.push(t0[i]) : 0
						var container = bs.GL.Mesh('rect').S('material', '#eee')
						i = t1.length
						while (i--) {
							t2 = t1[j++]
							t3 = t2.tagName
							console.log(t1[i], t2.getAttribute('width'))
							if (t3 == 'rect' || t3 == 'image') bs.GL.Mesh('rect').S(
									'pivotX', t2.width.baseVal.value / 2, 'pivotY', -t2.height.baseVal.value / 2,
									'scaleX', t2.width.baseVal.value, 'scaleY', t2.height.baseVal.value,
									'material', t3 == 'rect' ? checkColor(t2.getAttribute('fill')) : t2.getAttribute('xlink:href') + ',B',
									'<', container,
									'zSort', 0
							)
							else if (t3 == 'circle') {
								bs.GL.Mesh('circle').S(
										'x', t2.getAttribute('cx'), 'y', -t2.getAttribute('cy'),
										'scaleX', t2.getAttribute('r') * 2, 'scaleY', t2.getAttribute('r') * 2,
										'material', checkColor(t2.getAttribute('fill')),
										'<', container,
										'zSort', 0
								)
							} else if (t3 == 'ellipse') {
								bs.GL.Mesh('circle').S(
										'x', t2.getAttribute('cx'), 'y', -t2.getAttribute('cy'),
										'scaleX', t2.getAttribute('rx') * 2, 'scaleY', t2.getAttribute('ry') * 2,
										'material', checkColor(t2.getAttribute('fill')),
										'<', container,
										'zSort', 0
								)
							} else if (t3 == 'polygon') {
								t4 = t2.getAttribute('points').split(' ')
								var vs = []
								console.log(t4)
								for (var ii = 0; ii < t4.length; ii++) {
									t5 = t4[ii].split(',')
									vs.push(t5[0])
									vs.push(-t5[1])
									vs.push(0)
								}
								bs.GL.makeBufferSet('polygon' + t2.getAttribute('points'), vs, [], [])
								bs.GL.Mesh('polygon' + t2.getAttribute('points')).S(
										'material', checkColor(t2.getAttribute('fill')),
										'<', container,
										'zSort', 0
								)
							} else if (t3 == 'line') {
								var vs = []
								var _x1 = t2.getAttribute('x1'),_x2 =t2.getAttribute('x2'),_y1=t2.getAttribute('y1'),_y2=t2.getAttribute('y2')
								vs.push(_x1),vs.push(-_y1),vs.push(0)
								vs.push(_x2),vs.push(-_y2),vs.push(0)
								bs.GL.makeBufferSet('line_'+_x1+_y1+_x2+_y2, vs, [], [])
								bs.GL.Mesh('line_'+_x1+_y1+_x2+_y2).S(
										'material', checkLineColor(t2.getAttribute('stroke')),
										'<', container,
										'zSort', 0,
										'renderMode','LINES'
								)
							} else if (t3 == 'polyline') {
								t4 = t2.getAttribute('points').split(' ')
								var vs = []
								console.log(t4)
								for (var ii = 0; ii < t4.length; ii++) {
									t5 = t4[ii].split(',')
									vs.push(t5[0])
									vs.push(-t5[1])
									vs.push(0)
								}
								bs.GL.makeBufferSet('polyline' + t2.getAttribute('points'), vs, [], [])
								bs.GL.Mesh('polyline' + t2.getAttribute('points')).S(
										'material', checkColor(t2.getAttribute('fill')),
										'<', container,
										'zSort', 0,
										'renderMode','LINE_STRIP'
								)
							}
						}
						return container
					}
				})();

				//////////////////////////////////////////////////////////
				//////////////////////////////////////////////////////////
				var svgRect = bs.Dom('svg')[0]
				bs.GL.parserSVG(svgRect).S('<', bs.GL)
				//////////////////////////////////////////////////////////
				//////////////////////////////////////////////////////////

				var time = 0, ms = Math.sin, mc = Math.cos
				bs.ANI.ani({
					ANI: function () {
						time += 0.003
						var list = bs.GL.S('children'), i = list.length, t0, t1, j
						while (i--) {
							t0 = list[i]
							j = t0.children.length
//							while (j--) t1 = t0.children[j], t1.rotationZ += 0.001 * 15, t1.rotationY += 0.001 * 15
						}
					}
				})
			}
		}, '../gl.js')

	})
</script>
</body>
</html>
